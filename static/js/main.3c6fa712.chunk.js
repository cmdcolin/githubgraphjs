(this.webpackJsonpgithubgraphjs=this.webpackJsonpgithubgraphjs||[]).push([[0],{124:function(e,t,a){"use strict";a.r(t);var n=a(2),r=a.n(n),c=a(62),l=a.n(c),o=(a(77),a(0)),i=a(14),u=a(4),s=a(3),m=a.n(s),b=a(7),d=a(25),p=a(130),h=a(63),f=a.n(h),g=a(64),E=a.n(g),v=a(52);var j=function(e){var t=e.onSubmit,a=e.initialValues,n=Object(v.b)({onSubmit:t,initialValues:a}),c=n.form,l=n.handleSubmit,o=n.pristine,i=n.submitting,u=Object(v.a)("repo",c);return r.a.createElement("form",{onSubmit:l},r.a.createElement("div",null,r.a.createElement("label",null,"Repo name"),r.a.createElement("input",u.input)),r.a.createElement("button",{type:"submit",disabled:o||i},"Submit"))};var O=new f.a({cache:new E.a({maxSize:1e3}),fill:function(e,t){return Object(b.a)(m.a.mark((function a(){var n,r,c;return m.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return n=e.url,a.next=3,fetch(n,{headers:{Accept:"application/vnd.github.v3+json"},signal:t});case 3:if((r=a.sent).ok){a.next=6;break}throw new Error("HTTP ".concat(r.status," ").concat(r.statusText));case 6:return a.next=8,r.json();case 8:return c=a.sent,a.abrupt("return",{total:c.total_count,result:c.workflow_runs.map((function(e){return{message:(e.head_commit||{}).message.slice(0,20),branch:e.head_branch,github_link:e.id,duration:(new Date(e.updated_at)-new Date(e.created_at))/6e4,state:e.conclusion,updated_at:new Date(e.updated_at)}}))});case 10:case"end":return a.stop()}}),a)})))()}});function w(e){var t=e.counter,a=e.repo;return"https://api.github.com/repos/".concat(a,"/actions/runs?page=").concat(t/100,"&per_page=").concat(100)}function k(e){var t=e.build,a=e.repo;return r.a.createElement("table",null,r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",null,"Key"),r.a.createElement("th",null,"Value"))),r.a.createElement("tbody",null,Object.entries(t).map((function(e){var t=Object(u.a)(e,2),n=t[0],c=t[1];if(n.startsWith("yearmonth"))return null;if(n.startsWith("github")){var l="https://github.com/".concat(a,"/actions/runs/").concat(c);return r.a.createElement("tr",null,r.a.createElement("td",null,"link"),r.a.createElement("td",null,r.a.createElement("a",{href:l},l)))}return r.a.createElement("tr",{key:n},r.a.createElement("td",null,"".concat(n)),r.a.createElement("td",null,"".concat(c)))}))))}function y(e){var t=Object(n.useState)(),a=Object(u.a)(t,2),c=a[0],l=a[1],o=e.builds,i=e.query;return r.a.createElement("div",{style:{display:"flex"}},r.a.createElement(p.a,{data:{values:o},patch:function(e){return e.signals.push({name:"barClick",value:0,on:[{events:"*:mousedown",update:"datum"}]}),e},signalListeners:{barClick:function(e,t){l(t)}},spec:{$schema:"https://vega.github.io/schema/vega-lite/v4.json",width:1e3,height:400,mark:{type:"point",tooltip:{content:"data"}},data:{name:"values"},selection:{grid:{type:"interval",bind:"scales"}},encoding:{y:{field:"duration",type:"quantitative",axis:{title:"Duration (minutes)"}},x:{field:"updated_at",timeUnit:"yearmonthdatehoursminutes",type:"temporal",scale:{nice:"week"},axis:{title:"Date"}},color:{field:"state",type:"nominal",scale:{domain:["success","skipped","failure","canceled"],range:["#39aa56","#ff7f0e","#db4545","#9d9d9d"]}}}}}),c?r.a.createElement(k,{repo:i.repo,build:c}):null)}function x(){var e=Object(d.c)({repo:d.b}),t=Object(u.a)(e,2),a=t[0],c=t[1],l=Object(n.useState)(0),s=Object(u.a)(l,2)[1],p=function(e){var t=Object(n.useState)(0),a=Object(u.a)(t,2),r=a[0],c=a[1],l=Object(n.useState)(),s=Object(u.a)(l,2),d=s[0],p=s[1],h=Object(n.useState)(),f=Object(u.a)(h,2),g=f[0],E=f[1],v=Object(n.useState)(e.repo?"Loading...":""),j=Object(u.a)(v,2),k=j[0],y=j[1],x=Object(n.useState)([]),S=Object(u.a)(x,2),_=S[0],D=S[1];return Object(n.useEffect)((function(){Object(b.a)(m.a.mark((function t(){var a,n,r,l;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,!e||!e.repo){t.next=13;break}if((a=w(Object(i.a)({},e,{counter:_.length})))&&g&&!(g>=_.length)){t.next=12;break}return t.next=6,O.get(a,{url:a});case 6:n=t.sent,r=n.total,(l=n.result).length?(D([].concat(Object(o.a)(_),Object(o.a)(l))),E(r),y("Loading builds...".concat(_.length,"/").concat(r))):(y(void 0),c(0)),t.next=13;break;case 12:_.length?(y(void 0),c(0)):p("No builds loaded");case 13:t.next=18;break;case 15:t.prev=15,t.t0=t.catch(0),"AbortError"!==(u=t.t0).name&&"ERR_ABORTED"!==u.code&&"AbortError: aborted"!==u.message&&"Error: aborted"!==u.message&&(console.error(t.t0),p(t.t0.message));case 18:case"end":return t.stop()}var u}),t,null,[[0,15]])})))()}),[k,e,r,_,g]),[k,d,_]}(a),h=Object(u.a)(p,3),f=h[0],g=h[1],E=h[2];return r.a.createElement(r.a.Fragment,null,r.a.createElement("h1",null,"githubgraph-js - GitHub actions graphs"),r.a.createElement("p",null,"Enter a repo name"),r.a.createElement(j,{initialValues:a,onSubmit:function(e){c(e),s((function(e){return e+1}))}}),g?r.a.createElement("p",{style:{color:"red"}},g):void 0!==f?r.a.createElement("p",null,f):r.a.createElement(y,{builds:E,query:a}),r.a.createElement("a",{href:"https://github.com/cmdcolin/githubgraphjs/"},"source code"))}Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));l.a.render(r.a.createElement(d.a,null,r.a.createElement(x,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},72:function(e,t,a){e.exports=a(124)},77:function(e,t,a){}},[[72,1,2]]]);
//# sourceMappingURL=main.3c6fa712.chunk.js.map