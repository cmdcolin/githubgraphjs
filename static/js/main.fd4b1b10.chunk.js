(this.webpackJsonpgithubgraphjs=this.webpackJsonpgithubgraphjs||[]).push([[0],{124:function(e,t,a){"use strict";a.r(t);var n=a(2),r=a.n(n),c=a(62),o=a.n(c),i=(a(77),a(0)),l=a(14),u=a(4),s=a(3),d=a.n(s),m=a(7),b=a(25),h=a(130),p=a(63),f=a.n(p),g=a(64),v=a.n(g),E=a(52);var j=function(e){var t=e.onSubmit,a=e.initialValues,n=Object(E.b)({onSubmit:t,initialValues:a}),c=n.form,o=n.handleSubmit,i=n.pristine,l=n.submitting,u=Object(E.a)("repo",c);return r.a.createElement("form",{onSubmit:o},r.a.createElement("div",null,r.a.createElement("label",null,"Repo name"),r.a.createElement("input",u.input)),r.a.createElement("button",{type:"submit",disabled:i||l},"Submit"))};function O(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!e.length)return[];var t=e.concat();t.sort((function(e,t){return e.duration-t.duration}));var a=t[Math.floor(t.length/4)].duration,n=t[Math.min(Math.ceil(t.length*(3/4)),t.length-1)].duration,r=n-a,c=n+3*r,o=a-3*r;return t.filter((function(e){return e.duration<c&&e.duration>o&&!!e.updated_at}))}var w=new f.a({cache:new v.a({maxSize:1e3}),fill:function(e,t){return Object(m.a)(d.a.mark((function a(){var n,r,c;return d.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return n=e.url,a.next=3,fetch(n,{headers:{Accept:"application/vnd.github.v3+json"},signal:t});case 3:if((r=a.sent).ok){a.next=6;break}throw new Error("HTTP ".concat(r.status," ").concat(r.statusText));case 6:return a.next=8,r.json();case 8:return c=a.sent,a.abrupt("return",{total:c.total_count,result:O(c.workflow_runs.map((function(e){return{message:(e.head_commit||{}).message.slice(0,20),branch:e.head_branch,github_link:e.id,duration:(new Date(e.updated_at)-new Date(e.created_at))/6e4,state:e.conclusion,updated_at:new Date(e.updated_at)}})))});case 10:case"end":return a.stop()}}),a)})))()}});function k(e){var t=e.counter,a=e.repo;return"https://api.github.com/repos/".concat(a,"/actions/runs?page=").concat(Math.floor(t/100),"&per_page=").concat(100)}function y(e){var t=e.build,a=e.repo;return r.a.createElement("table",null,r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",null,"Key"),r.a.createElement("th",null,"Value"))),r.a.createElement("tbody",null,Object.entries(t).map((function(e){var t=Object(u.a)(e,2),n=t[0],c=t[1];if(n.startsWith("yearmonth"))return null;if(n.startsWith("github")){var o="https://github.com/".concat(a,"/actions/runs/").concat(c);return r.a.createElement("tr",null,r.a.createElement("td",null,"link"),r.a.createElement("td",null,r.a.createElement("a",{href:o},o)))}return r.a.createElement("tr",{key:n},r.a.createElement("td",null,"".concat(n)),r.a.createElement("td",null,"".concat(c)))}))))}function x(e){var t=Object(n.useState)(),a=Object(u.a)(t,2),c=a[0],o=a[1],i=e.builds,l=e.query;return r.a.createElement("div",{style:{display:"flex"}},r.a.createElement(h.a,{data:{values:i},patch:function(e){return e.signals.push({name:"barClick",value:0,on:[{events:"*:mousedown",update:"datum"}]}),e},signalListeners:{barClick:function(e,t){o(t)}},spec:{$schema:"https://vega.github.io/schema/vega-lite/v4.json",width:1e3,height:400,mark:{type:"point",tooltip:{content:"data"}},data:{name:"values"},selection:{grid:{type:"interval",bind:"scales"}},encoding:{y:{field:"duration",type:"quantitative",axis:{title:"Duration (minutes)"}},x:{field:"updated_at",timeUnit:"yearmonthdatehoursminutes",type:"temporal",scale:{nice:"week"},axis:{title:"Date"}},color:{field:"state",type:"nominal",scale:{domain:["success","skipped","failure","canceled"],range:["#39aa56","#ff7f0e","#db4545","#9d9d9d"]}}}}}),c?r.a.createElement(y,{repo:l.repo,build:c}):null)}function S(){var e=Object(b.c)({repo:b.b}),t=Object(u.a)(e,2),a=t[0],c=t[1],o=Object(n.useState)(0),s=Object(u.a)(o,2)[1],h=function(e){var t=Object(n.useState)(0),a=Object(u.a)(t,2),r=a[0],c=a[1],o=Object(n.useState)(),s=Object(u.a)(o,2),b=s[0],h=s[1],p=Object(n.useState)(),f=Object(u.a)(p,2),g=f[0],v=f[1],E=Object(n.useState)(e.repo?"Loading...":""),j=Object(u.a)(E,2),O=j[0],y=j[1],x=Object(n.useState)([]),S=Object(u.a)(x,2),_=S[0],D=S[1];return Object(n.useEffect)((function(){Object(m.a)(d.a.mark((function t(){var a,n,r,o;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,!e||!e.repo){t.next=13;break}if((a=k(Object(l.a)({},e,{counter:_.length})))&&g&&!(g>=_.length)){t.next=12;break}return t.next=6,w.get(a,{url:a});case 6:n=t.sent,r=n.total,(o=n.result).length?(D([].concat(Object(i.a)(_),Object(i.a)(o))),v(r),y("Loading builds...".concat(_.length,"/").concat(r))):(y(void 0),c(0)),t.next=13;break;case 12:_.length?(y(void 0),c(0)):h("No builds loaded");case 13:t.next=18;break;case 15:t.prev=15,t.t0=t.catch(0),"AbortError"!==(u=t.t0).name&&"ERR_ABORTED"!==u.code&&"AbortError: aborted"!==u.message&&"Error: aborted"!==u.message&&(console.error(t.t0),h(t.t0.message));case 18:case"end":return t.stop()}var u}),t,null,[[0,15]])})))()}),[O,e,r,_,g]),[O,b,_]}(a),p=Object(u.a)(h,3),f=p[0],g=p[1],v=p[2];return r.a.createElement(r.a.Fragment,null,r.a.createElement("h1",null,"githubgraph-js - GitHub actions graphs"),r.a.createElement("p",null,"Enter a repo name"),r.a.createElement(j,{initialValues:a,onSubmit:function(e){c(e),s((function(e){return e+1}))}}),g?r.a.createElement("p",{style:{color:"red"}},g):void 0!==f?r.a.createElement("p",null,f):r.a.createElement(x,{builds:v,query:a}),r.a.createElement("a",{href:"https://github.com/cmdcolin/githubgraphjs/"},"source code"))}Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement(b.a,null,r.a.createElement(S,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},72:function(e,t,a){e.exports=a(124)},77:function(e,t,a){}},[[72,1,2]]]);
//# sourceMappingURL=main.fd4b1b10.chunk.js.map